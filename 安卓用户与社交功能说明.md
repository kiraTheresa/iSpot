# Android ç¤¾äº¤ä¸ç”¨æˆ·åŠŸèƒ½è¯´æ˜æ–‡æ¡£

> 



---

## ğŸ§© é¡¹ç›®ç»“æ„

```
com.ispot.android
â”œâ”€â”€ ui                   # ç•Œé¢å±‚
â”‚   â”œâ”€â”€ login             # ç™»å½•
â”‚   â”œâ”€â”€ register          # æ³¨å†Œ
â”‚   â”œâ”€â”€ feed              # åŠ¨æ€åˆ—è¡¨ä¸å‘å¸ƒ
â”‚   â””â”€â”€ user              # ç”¨æˆ·ä¿¡æ¯é¡µ
â”œâ”€â”€ data                 # æ•°æ®ä¸ç½‘ç»œå±‚
â”‚   â”œâ”€â”€ model             # å®ä½“ç±» (User, Post)
â”‚   â”œâ”€â”€ network           # Retrofit æ¥å£å®šä¹‰ä¸å‡æ•°æ®æœåŠ¡
â”‚   â””â”€â”€ repository        # Repository æ•°æ®ä»“åº“å±‚
â””â”€â”€ utils                # å·¥å…·ç±» (Session ç®¡ç†ç­‰)
```

---

## ğŸ§  æ ¸å¿ƒæ•°æ®æ¨¡å‹

### ğŸ§ ç”¨æˆ·æ¨¡å‹ï¼ˆUserï¼‰

| å­—æ®µ             | ç±»å‹     | è¯´æ˜     |
| -------------- | ------ | ------ |
| id             | String | ç”¨æˆ·å”¯ä¸€ID |
| username       | String | ç™»å½•ç”¨æˆ·å  |
| password       | String | ç™»å½•å¯†ç    |
| nickname       | String | æ˜µç§°     |
| avatarUrl      | String | ç”¨æˆ·å¤´åƒ   |
| bio            | String | ç®€ä»‹     |
| lastActiveTime | Long   | æœ€è¿‘æ´»è·ƒæ—¶é—´ |

---

### ğŸ—£ åŠ¨æ€æ¨¡å‹ï¼ˆPostï¼‰

| å­—æ®µ        | ç±»å‹     | è¯´æ˜       |
| --------- | ------ | -------- |
| id        | String | åŠ¨æ€å”¯ä¸€æ ‡è¯†   |
| userId    | String | å‘å¸ƒè€…ID    |
| content   | String | åŠ¨æ€å†…å®¹     |
| imageUrl  | String | å›¾ç‰‡åœ°å€ï¼ˆé€‰å¡«ï¼‰ |
| timestamp | Long   | å‘å¸ƒæ—¶é—´     |
| likeCount | Int    | ç‚¹èµæ•°      |

---

## ğŸŒ ç½‘ç»œå±‚è®¾è®¡

### `ApiService.kt`

```kotlin
interface ApiService {
    @POST("user/login")
    fun login(@Body request: LoginRequest): Call<LoginResponse>

    @POST("user/register")
    fun register(@Body request: RegisterRequest): Call<RegisterResponse>

    @GET("posts")
    fun getAllPosts(): Call<List<Post>>

    @POST("posts/create")
    fun createPost(@Body post: Post): Call<Post>

    @POST("posts/{id}/like")
    fun likePost(@Path("id") id: String): Call<Void>
}
```

### `FakeApiService.kt`

- æ¨¡æ‹Ÿåç«¯æ•°æ®åˆ—è¡¨ `users` ä¸ `posts`  
- æä¾›ç™»å½•ã€æ³¨å†Œã€å‘å¸ƒåŠ¨æ€ã€ç‚¹èµç­‰é€»è¾‘  
- ä½¿ç”¨ `FakeCall` æ¨¡æ‹Ÿ Retrofit å¼‚æ­¥å“åº”  

---

## ğŸ” ç”¨æˆ·åŠŸèƒ½æ¨¡å—

### ç™»å½• / æ³¨å†Œé€»è¾‘

1. éªŒè¯è¾“å…¥æ˜¯å¦ä¸ºç©º  
2. è°ƒç”¨åç«¯æ¥å£ï¼ˆRetrofitï¼‰  
3. ç™»å½•æˆåŠŸåä¿å­˜ token ä¸ userId  
4. è·³è½¬è‡³ä¸»é¡µé¢ï¼ˆFeedActivityï¼‰

```kotlin
NetworkModule.apiService.login(LoginRequest(u, p)).enqueue(object : Callback<LoginResponse> {
    override fun onResponse(call: Call<LoginResponse>, response: Response<LoginResponse>) {
        val body = response.body()
        if (body != null && body.token?.isNotEmpty() == true) {
            session.saveToken(body.token)
            session.saveUserId(body.user?.id ?: "")
            startActivity(Intent(this@LoginActivity, FeedActivity::class.java))
        } else {
            Toast.makeText(this@LoginActivity, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯", Toast.LENGTH_SHORT).show()
        }
    }
})
```

---

### ğŸ”‘ æœ¬åœ°æŒä¹…åŒ–ï¼š`SessionManager`

| åŠŸèƒ½     | è¯´æ˜                   |
| ------ | -------------------- |
| ä¿å­˜ç™»å½•çŠ¶æ€ | ä¿å­˜ token ä¸ userId    |
| è‡ªåŠ¨ç™»å½•   | å¯åŠ¨æ—¶æ£€æŸ¥æ˜¯å¦æœ‰ token       |
| é€€å‡ºç™»å½•   | æ¸…ç©º SharedPreferences |

---

## ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯é¡µ UserActivity

- æ˜¾ç¤ºç”¨æˆ·åã€å¤´åƒã€ç®€ä»‹  
- æ”¯æŒæ˜µç§°å’Œç®€ä»‹ç¼–è¾‘  
- ç‚¹å‡»â€œä¿å­˜â€åå‘é€ `PUT /user/update` è¯·æ±‚

UI ç¤ºä¾‹ï¼š

```xml
<LinearLayout ...>
    <ImageView android:id="@+id/ivAvatar" ... />
    <EditText android:id="@+id/etNickname" ... />
    <EditText android:id="@+id/etBio" ... />
    <Button android:id="@+id/btnSave" android:text="ä¿å­˜" />
</LinearLayout>
```

é€»è¾‘è¦ç‚¹ï¼š

```kotlin
btnSave.setOnClickListener {
    val updatedUser = currentUser.copy(
        nickname = etNickname.text.toString(),
        bio = etBio.text.toString()
    )
    userRepository.updateUser(updatedUser)
}
```

---

## ğŸ’¬ ç¤¾äº¤åŠŸèƒ½æ¨¡å—

### ğŸ“œ åŠ¨æ€åˆ—è¡¨ï¼ˆFeedFragmentï¼‰

- ä½¿ç”¨ `RecyclerView` å±•ç¤ºæ‰€æœ‰åŠ¨æ€  
- æ¯é¡¹åŒ…æ‹¬ï¼šå¤´åƒã€å†…å®¹ã€æ—¶é—´ã€ç‚¹èµæŒ‰é’®  
- ç‚¹èµçŠ¶æ€å³æ—¶æ›´æ–°  

```kotlin
feedAdapter.onLikeClick = { post ->
    NetworkModule.apiService.likePost(post.id).enqueue(...)
}
```

---

### ğŸ“ å‘å¸ƒåŠ¨æ€ï¼ˆPostActivityï¼‰

- è¾“å…¥æ–‡å­—å†…å®¹  
- é€‰å¡«å›¾ç‰‡ä¸Šä¼   
- è°ƒç”¨ `createPost()` æ¥å£  

```kotlin
btnPublish.setOnClickListener {
    val post = Post(userId = session.getUserId(), content = etContent.text.toString())
    postRepository.createPost(post)
}
```

---

## ğŸ”„ é¡µé¢ä¸äº¤äº’æµç¨‹

```
æ³¨å†Œ â†’ ç™»å½• â†’ ä¸»ç•Œé¢ï¼ˆFeedActivityï¼‰
                     â”œâ”€â”€ åŠ¨æ€åˆ—è¡¨ï¼ˆFeedFragmentï¼‰
                     â”œâ”€â”€ å‘å¸ƒåŠ¨æ€ï¼ˆPostActivityï¼‰
                     â””â”€â”€ ç”¨æˆ·ä¸­å¿ƒï¼ˆUserActivityï¼‰
```

---

## ğŸ“‚ ä¸»è¦æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶                  | åŠŸèƒ½           |
| ------------------- | ------------ |
| `ApiService.kt`     | Retrofitæ¥å£å®šä¹‰ |
| `FakeApiService.kt` | æ¨¡æ‹Ÿåç«¯æœåŠ¡       |
| `NetworkModule.kt`  | Retrofitåˆå§‹åŒ–  |
| `UserRepository.kt` | ç”¨æˆ·æ•°æ®ç®¡ç†       |
| `PostRepository.kt` | åŠ¨æ€æ•°æ®ç®¡ç†       |
| `FeedFragment.kt`   | åŠ¨æ€å±•ç¤º         |
| `PostActivity.kt`   | å‘å¸ƒåŠ¨æ€         |
| `UserActivity.kt`   | ç”¨æˆ·ä¿¡æ¯ç®¡ç†       |
| `SessionManager.kt` | ç™»å½•çŠ¶æ€å­˜å‚¨       |
